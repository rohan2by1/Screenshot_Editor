<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screenshot Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tool-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        button {
            padding: 10px 16px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        button.active {
            background: #764ba2;
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        button.success {
            background: #28a745;
        }

        button.success:hover {
            background: #218838;
        }

        input[type="color"] {
            width: 50px;
            height: 38px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
        }

        input[type="range"] {
            width: 120px;
        }

        input[type="number"] {
            width: 70px;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        input[type="text"] {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            min-width: 200px;
        }

        label {
            font-size: 14px;
            font-weight: 500;
            color: #495057;
        }

        .canvas-container {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            background: #e9ecef;
        }

        #canvas {
            border: 2px solid #dee2e6;
            background: white;
            cursor: crosshair;
            max-width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .instructions {
            padding: 20px;
            background: #fff3cd;
            border-top: 1px solid #ffc107;
            text-align: center;
            color: #856404;
        }

        .separator {
            width: 1px;
            height: 30px;
            background: #dee2e6;
            margin: 0 5px;
        }

        .emoji {
            font-style: normal;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .toolbar {
                padding: 10px;
            }

            .canvas-container {
                padding: 10px;
            }

            #canvas {
                max-width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ Screenshot Editor</h1>
            <p>Paste, Edit, and Copy back to Clipboard</p>
        </div>

        <div class="toolbar">
            <div class="tool-group">
                <button id="pasteBtn" title="Paste from Clipboard (Ctrl+V)">
                    <span class="emoji">üìã</span> Paste Image
                </button>
                <button id="clearBtn" class="secondary" title="Clear Canvas">
                    <span class="emoji">üóëÔ∏è</span> Clear
                </button>
            </div>

            <div class="separator"></div>

            <div class="tool-group">
                <button id="penBtn" class="active" title="Draw">
                    <span class="emoji">‚úèÔ∏è</span> Pen
                </button>
                <button id="lineBtn" title="Draw Line">
                    <span class="emoji">üìè</span> Line
                </button>
                <button id="rectBtn" title="Draw Rectangle">
                    <span class="emoji">‚ñ≠</span> Rectangle
                </button>
                <button id="circleBtn" title="Draw Circle">
                    <span class="emoji">‚≠ï</span> Circle
                </button>
                <button id="arrowBtn" title="Draw Arrow">
                    <span class="emoji">‚û°Ô∏è</span> Arrow
                </button>
                <button id="textBtn" title="Add Text">
                    <span class="emoji">üìù</span> Text
                </button>
            </div>

            <div class="separator"></div>

            <div class="tool-group">
                <label>Color:</label>
                <input type="color" id="colorPicker" value="#ff0000">
            </div>

            <div class="tool-group">
                <label>Size:</label>
                <input type="number" id="lineWidth" value="3" min="1" max="50">
            </div>

            <div class="separator"></div>

            <div class="tool-group">
                <button id="undoBtn" class="secondary" title="Undo (Ctrl+Z)">
                    <span class="emoji">‚Ü©Ô∏è</span> Undo
                </button>
                <button id="redoBtn" class="secondary" title="Redo (Ctrl+Y)">
                    <span class="emoji">‚Ü™Ô∏è</span> Redo
                </button>
            </div>

            <div class="separator"></div>

            <div class="tool-group">
                <button id="copyBtn" class="success" title="Copy to Clipboard">
                    <span class="emoji">üìã</span> Copy to Clipboard
                </button>
                <button id="downloadBtn" class="success" title="Download Image">
                    <span class="emoji">üíæ</span> Download
                </button>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="instructions">
            <strong>üí° Quick Start:</strong> Press Ctrl+V or click "Paste Image" to load a screenshot from your clipboard. 
            Edit it using the tools above, then click "Copy to Clipboard" to save your edited image!
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#ff0000';
        let lineWidth = 3;
        let startX, startY;
        let history = [];
        let historyStep = -1;
        let tempCanvas = null;

        // Tool buttons
        document.getElementById('penBtn').addEventListener('click', () => setTool('pen'));
        document.getElementById('lineBtn').addEventListener('click', () => setTool('line'));
        document.getElementById('rectBtn').addEventListener('click', () => setTool('rect'));
        document.getElementById('circleBtn').addEventListener('click', () => setTool('circle'));
        document.getElementById('arrowBtn').addEventListener('click', () => setTool('arrow'));
        document.getElementById('textBtn').addEventListener('click', () => setTool('text'));

        // Settings
        document.getElementById('colorPicker').addEventListener('input', (e) => {
            currentColor = e.target.value;
        });

        document.getElementById('lineWidth').addEventListener('input', (e) => {
            lineWidth = parseInt(e.target.value);
        });

        // Action buttons
        document.getElementById('pasteBtn').addEventListener('click', pasteFromClipboard);
        document.getElementById('clearBtn').addEventListener('click', clearCanvas);
        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
        document.getElementById('downloadBtn').addEventListener('click', downloadImage);
        document.getElementById('undoBtn').addEventListener('click', undo);
        document.getElementById('redoBtn').addEventListener('click', redo);

        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-group button[id$="Btn"]:not(.secondary):not(.success)').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tool + 'Btn').classList.add('active');
        }

        async function pasteFromClipboard() {
            try {
                const items = await navigator.clipboard.read();
                
                for (const item of items) {
                    for (const type of item.types) {
                        if (type.startsWith('image/')) {
                            const blob = await item.getType(type);
                            const img = new Image();
                            img.onload = () => {
                                canvas.width = img.width;
                                canvas.height = img.height;
                                ctx.drawImage(img, 0, 0);
                                saveState();
                                URL.revokeObjectURL(img.src);
                            };
                            img.src = URL.createObjectURL(blob);
                            return;
                        }
                    }
                }
                alert('No image found in clipboard. Please copy an image first!');
            } catch (err) {
                console.error('Failed to read clipboard:', err);
                alert('Failed to paste from clipboard. Make sure you have granted clipboard permissions!');
            }
        }

        async function copyToClipboard() {
            try {
                canvas.toBlob(async (blob) => {
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    
                    // Visual feedback
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<span class="emoji">‚úÖ</span> Copied!';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                    }, 2000);
                });
            } catch (err) {
                console.error('Failed to copy to clipboard:', err);
                alert('Failed to copy to clipboard!');
            }
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = `edited-screenshot-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function clearCanvas() {
            if (confirm('Are you sure you want to clear the canvas?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                saveState();
            }
        }

        function saveState() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(canvas.toDataURL());
        }

        function undo() {
            if (historyStep > 0) {
                historyStep--;
                restoreState(history[historyStep]);
            }
        }

        function redo() {
            if (historyStep < history.length - 1) {
                historyStep++;
                restoreState(history[historyStep]);
            }
        }

        function restoreState(dataUrl) {
            const img = new Image();
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
            img.src = dataUrl;
        }

        // Drawing functions
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch support for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        });

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;

            if (currentTool === 'pen') {
                ctx.beginPath();
                ctx.moveTo(startX, startY);
            } else if (currentTool === 'text') {
                const text = prompt('Enter text:');
                if (text) {
                    ctx.font = `${lineWidth * 8}px Arial`;
                    ctx.fillStyle = currentColor;
                    ctx.fillText(text, startX, startY);
                    saveState();
                }
                isDrawing = false;
            } else {
                tempCanvas = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
        }

        function draw(e) {
            if (!isDrawing) return;

            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;

            ctx.strokeStyle = currentColor;
            ctx.lineWidth = lineWidth;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (currentTool === 'pen') {
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
            } else if (tempCanvas) {
                ctx.putImageData(tempCanvas, 0, 0);
                
                ctx.beginPath();
                if (currentTool === 'line') {
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(currentX, currentY);
                    ctx.stroke();
                } else if (currentTool === 'rect') {
                    ctx.strokeRect(startX, startY, currentX - startX, currentY - startY);
                } else if (currentTool === 'circle') {
                    const radius = Math.sqrt(Math.pow(currentX - startX, 2) + Math.pow(currentY - startY, 2));
                    ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                    ctx.stroke();
                } else if (currentTool === 'arrow') {
                    drawArrow(startX, startY, currentX, currentY);
                }
            }
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveState();
            }
        }

        function drawArrow(fromX, fromY, toX, toY) {
            const headLength = lineWidth * 5;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'v') {
                    e.preventDefault();
                    pasteFromClipboard();
                } else if (e.key === 'z') {
                    e.preventDefault();
                    undo();
                } else if (e.key === 'y') {
                    e.preventDefault();
                    redo();
                }
            }
        });

        // Initialize canvas
        canvas.width = 800;
        canvas.height = 600;
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        saveState();
    </script>
</body>
</html>
